@model List<PuanOdulSistemi.Models.Odul>
@{
    ViewData["Title"] = "Oduller";
    ViewData["Active"] = "Oduller";
    Layout = "~/Views/Shared/_OgrenciLayout.cshtml";
    int toplamPuan = ViewBag.ToplamPuan ?? 0;
}

<div class="page-head">
    <p>Toplam onayli puanin: <strong class="text-primary">@toplamPuan</strong></p>
</div>

@if (!Model.Any())
{
    <section class="surface-card empty-state">
        <div class="empty-icon"><i class="bi bi-gift"></i></div>
        <h4>Henuz odul yok</h4>
        <p>Admin panelinden odul tanimlandiginda burada gorunecek.</p>
    </section>
}
else
{
    <div class="reward-grid">
        @foreach (var odul in Model)
        {
            bool kazanildi = toplamPuan >= odul.GerekliPuan;
            int ilerleme = odul.GerekliPuan > 0 ? (int)Math.Min(100, (double)toplamPuan / odul.GerekliPuan * 100) : 100;

            <article class="reward-card">
                <div class="reward-media position-relative">
                    @if (!string.IsNullOrEmpty(odul.GorselYolu))
                    {
                        <img src="@odul.GorselYolu" alt="@odul.Ad" />
                    }
                    else
                    {
                        <i class="bi bi-gift-fill"></i>
                    }

                    <span class="position-absolute top-0 end-0 m-2 reward-state @(kazanildi ? "done" : "pending")">
                        <i class="bi @(kazanildi ? "bi-check-circle-fill" : "bi-hourglass-split")"></i>
                        @(kazanildi ? "Kazanildi" : "Bekliyor")
                    </span>
                </div>

                <div class="reward-body">
                    <h6>@odul.Ad</h6>
                    @if (!string.IsNullOrEmpty(odul.Aciklama))
                    {
                        <p>@odul.Aciklama</p>
                    }

                    <div class="d-flex justify-content-between mb-1 small">
                        <span class="text-muted">Gerekli puan</span>
                        <strong class="text-primary">@odul.GerekliPuan</strong>
                    </div>
                    <div class="progress-soft mb-1">
                        <div class="bar" style="width:@ilerleme%"></div>
                    </div>
                    <small class="text-muted">
                        @(kazanildi ? "Tamamlandi" : $"{toplamPuan} / {odul.GerekliPuan}")
                    </small>
                </div>
            </article>
        }
    </div>
}
