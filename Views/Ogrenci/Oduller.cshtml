@model List<PuanOdulSistemi.Models.Odul>
@{
    ViewData["Title"] = "√ñd√ºller";
    ViewData["Active"] = "Oduller";
    Layout = "~/Views/Shared/_OgrenciLayout.cshtml";
    int toplamPuan = ViewBag.ToplamPuan ?? 0;
}

<div class="d-flex align-items-center justify-content-between mb-4">
    <div>
        <p class="text-muted mb-0">Toplam onaylƒ± puanƒ±nƒ±z: <strong class="text-primary fs-5">@toplamPuan</strong></p>
    </div>
</div>

@if (!Model.Any())
{
    <div class="card p-5 text-center text-muted">
        <div style="font-size: 3rem;">üéÅ</div>
        <p class="mt-2">Hen√ºz √∂d√ºl tanƒ±mlanmamƒ±≈ü.</p>
    </div>
}
else
{
    <div class="row g-4">
        @foreach (var odul in Model)
        {
            bool kazanildi = toplamPuan >= odul.GerekliPuan;
            int ilerleme = odul.GerekliPuan > 0 ? (int)Math.Min(100, (double)toplamPuan / odul.GerekliPuan * 100) : 100;

            <div class="col-sm-6 col-lg-4">
                <div class="card odul-card h-100 @(kazanildi ? "border-success" : "")" style="@(kazanildi ? "border: 2px solid #198754;" : "")">
                    <div class="position-relative">
                        @if (!string.IsNullOrEmpty(odul.GorselYolu))
                        {
                            <img src="@odul.GorselYolu" alt="@odul.Ad" />
                        }
                        else
                        {
                            <div class="placeholder-img">üéÅ</div>
                        }
                        @if (kazanildi)
                        {
                            <span class="position-absolute top-0 end-0 m-2 badge bg-success">
                                <i class="bi bi-check-lg"></i> Kazanƒ±ldƒ±!
                            </span>
                        }
                    </div>
                    <div class="card-body">
                        <h6 class="card-title fw-bold">@odul.Ad</h6>
                        @if (!string.IsNullOrEmpty(odul.Aciklama))
                        {
                            <p class="card-text text-muted small">@odul.Aciklama</p>
                        }
                        <div class="mt-2">
                            <div class="d-flex justify-content-between mb-1">
                                <small class="text-muted">Gerekli Puan</small>
                                <small class="fw-bold text-primary">@odul.GerekliPuan</small>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar @(kazanildi ? "bg-success" : "bg-primary")"
                                     role="progressbar" style="width: @ilerleme%"></div>
                            </div>
                            <small class="text-muted">
                                @if (kazanildi)
                                {
                                    <span class="text-success fw-semibold">Tamamlandƒ±! ‚úì</span>
                                }
                                else
                                {
                                    @($"{toplamPuan} / {odul.GerekliPuan}")
                                }
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}
